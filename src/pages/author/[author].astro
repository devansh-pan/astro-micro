---
import Layout from "@layouts/Layout.astro";
import Container from "@components/Container.astro";
import FormattedDate from "@components/FormattedDate.astro";
---
import { getCollection } from 'astro:content';
import allAuthors from '../../content/authors.json';  // Import all authors

// Generate static paths for each author in the JSON file
export async function getStaticPaths() {
  const posts = await getCollection('blog');  // Fetch all blog posts (optional, for extra checks)
  const authors = Object.keys(allAuthors);    // Get all author slugs from the JSON file

  return authors.map((author) => ({
    params: { author },   // Create paths for each author using their slug (JSON keys)
    props: { author },    // Pass the author slug as props to be used in the template
  }));
}

// Fetch author-specific data
const { author } = Astro.params;  // Get author slug from the route params
const posts = await getCollection('blog', ({ author: postAuthor }) => postAuthor === author);  // Get posts by this author
const authorInfo = allAuthors[author];  // Get the author data from the JSON file
---

<!-- Check if the author exists -->
{authorInfo ? (
  <>
    <!-- Author Details -->
    <h1>{authorInfo.name}</h1>
    <p>{authorInfo.bio}</p>
    <img src={authorInfo.avatar} alt={authorInfo.name} width="150" />

    <!-- List of Posts by Author -->
    <h2>Posts by {authorInfo.name}</h2>
    <ul>
      {posts.map((post) => (
        <li><a href={post.url}>{post.title}</a></li>
      ))}
    </ul>
  </>
) : (
  <p>Author not found.</p>
)}

<Layout title= description=>
<Container>
<h1>Goodnight !</h1>
</Container>
</Layout>
